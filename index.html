<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyectos Alex</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    
    <!-- IMPORTANTE: Librer√≠a de Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        /* --- ESTILOS GENERALES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: #ffffff; color: #1e293b; line-height: 1.5; }
        input, button, textarea, select { font-family: inherit; }
        .container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; }

        /* --- NAVEGACI√ìN --- */
        nav { position: sticky; top: 0; z-index: 50; border-bottom: 1px solid #e2e8f0; background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        nav .container { display: flex; height: 4rem; align-items: center; justify-content: space-between; }
        .nav-brand { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; text-decoration: none; color: inherit; }
        
        /* LOGO SVG */
        .logo-svg { width: 3rem; height: 3rem; filter: drop-shadow(0px 2px 2px rgba(0,0,0,0.1)); transition: transform 0.2s ease; }
        .nav-brand:hover .logo-svg { transform: scale(1.05); }
        .nav-brand span { font-size: 1.125rem; font-weight: 700; }
        .nav-buttons { display: flex; align-items: center; gap: 1rem; }

        /* --- BOTONES --- */
        button { padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; }
        .btn-primary { background-color: #2563eb; color: white; }
        .btn-primary:hover { background-color: #1d4ed8; transform: translateY(-1px); }
        .btn-outline { border: 1px solid #e2e8f0; background-color: white; color: #1e293b; }
        .btn-outline:hover { background-color: #f8fafc; border-color: #cbd5e1; }
        .btn-danger { background-color: #dc2626; color: white; }
        .btn-danger:hover { background-color: #b91c1c; }
        
        .btn-visit { background-color: #ffffff; color: #2563eb; border: 1px solid #e2e8f0; width: 100%; margin-top: 1rem; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.625rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; }
        .btn-visit:hover { border-color: #2563eb; background-color: #f0f9ff; color: #1d4ed8; transform: translateY(-1px); }

        .btn-delete { background-color: #fff1f2; color: #e11d48; border: 1px solid transparent; width: 100%; margin-top: 0.5rem; padding: 0.625rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; cursor: pointer; }
        .btn-delete:hover { background-color: #ffe4e6; color: #be123c; }

        .btn-edit { background-color: #eff6ff; color: #2563eb; border: 1px solid transparent; width: 100%; margin-top: 0.5rem; padding: 0.625rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; cursor: pointer; }
        .btn-edit:hover { background-color: #dbeafe; color: #1e40af; }

        .btn-premium { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; width: 100%; margin-top: 0.5rem; padding: 0.625rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; cursor: pointer; border: none; box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3); }
        .btn-premium:hover { transform: translateY(-1px); box-shadow: 0 4px 6px rgba(245, 158, 11, 0.4); filter: brightness(1.1); }

        .btn-cancel-premium { background-color: #fffbeb; color: #b45309; border: 1px solid #fcd34d; width: 100%; margin-top: 0.5rem; padding: 0.625rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s; cursor: pointer; }
        .btn-cancel-premium:hover { background-color: #fef3c7; border-color: #f59e0b; }

        /* --- PUBLICIDAD --- */
        .ad-container { width: 100%; margin: 2rem 0; display: flex; justify-content: center; }
        .ad-placeholder { width: 100%; max-width: 728px; height: 90px; background-color: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .ad-label { font-size: 0.65rem; text-transform: uppercase; color: #94a3b8; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .ad-content { font-size: 1.25rem; color: #cbd5e1; font-weight: 700; }

        /* --- SPA --- */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HERO --- */
        .hero { padding: 6rem 1rem 8rem; text-align: center; }
        .hero h1 { font-size: 3.5rem; font-weight: 800; line-height: 1.1; margin-bottom: 1.5rem; }
        .hero h1 .highlight { color: #2563eb; }
        .hero p { font-size: 1.25rem; color: #64748b; max-width: 42rem; margin: 0 auto 2rem; }
        .hero-buttons { display: flex; gap: 1rem; justify-content: center; }

        /* --- PROYECTOS --- */
        .search-section { padding: 3rem 1rem; background-color: #f8fafc; border-y: 1px solid #e2e8f0; }
        .search-box { max-width: 42rem; margin: 0 auto; position: relative; }
        .search-box input { width: 100%; padding: 1rem 1rem 1rem 3rem; border: 1px solid #cbd5e1; border-radius: 0.75rem; font-size: 1rem; }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #94a3b8; }
        
        .projects-section { padding: 6rem 1rem; background-color: #ffffff; }
        .projects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem; }
        
        .project-card { background: white; border-radius: 0.75rem; overflow: hidden; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s; display: flex; flex-direction: column; }
        .project-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .project-card.is-premium { border: 2px solid #f59e0b; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15); }
        .premium-badge { background: #fffbeb; color: #b45309; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 99px; font-weight: 700; display: inline-flex; align-items: center; gap: 0.25rem; border: 1px solid #fcd34d; margin-bottom: 0.5rem; width: fit-content; }

        .project-image { height: 200px; position: relative; background: #f1f5f9; cursor: pointer; }
        .project-image-placeholder { width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; }
        .project-image img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .project-content { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
        .project-title-link { cursor: pointer; color: #0f172a; text-decoration: none; transition: color 0.2s; }
        .project-title-link:hover { color: #2563eb; }
        .project-meta { display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #f1f5f9; margin-top: auto; }
        .project-price { font-weight: 700; color: #2563eb; }
        .project-author-link { font-size: 0.875rem; color: #94a3b8; text-decoration: none; transition: color 0.2s; cursor: pointer; }
        .project-author-link:hover { color: #2563eb; text-decoration: underline; }
        
        .author-container { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; transition: opacity 0.2s; }
        .author-container:hover { opacity: 0.8; }
        .author-avatar-small { width: 24px; height: 24px; border-radius: 50%; background-color: #dbeafe; color: #2563eb; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 700; object-fit: cover; border: 1px solid #e2e8f0; }

        /* --- DASHBOARD & FORM --- */
        .dashboard-header { background: #f8fafc; padding: 3rem 1rem; border-bottom: 1px solid #e2e8f0; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #f1f5f9; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .form-container { max-width: 600px; margin: 3rem auto; padding: 2.5rem; background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; }
        .profile-avatar-large { width: 80px; height: 80px; background: #dbeafe; color: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; border: 4px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); object-fit: cover; }

        /* --- DETALLES --- */
        .project-detail-header { padding-bottom: 2rem; border-bottom: 1px solid #e2e8f0; margin-bottom: 2rem; }
        .project-detail-title { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; color: #0f172a; }
        .project-detail-image { width: 100%; height: 400px; object-fit: cover; border-radius: 1rem; margin-bottom: 2rem; background-color: #f1f5f9; }
        .project-detail-meta { display: flex; gap: 2rem; color: #64748b; margin-bottom: 2rem; align-items: center; }
        .detail-price { font-size: 1.5rem; font-weight: 700; color: #2563eb; }
        .detail-category { background-color: #eff6ff; color: #2563eb; padding: 0.25rem 0.75rem; border-radius: 999px; font-weight: 600; font-size: 0.875rem; }

        /* --- MODALES --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-card { background: white; width: 100%; max-width: 400px; padding: 2.5rem; border-radius: 1rem; position: relative; transform: translateY(20px); transition: all 0.3s; }
        .modal-overlay.active .modal-card { transform: translateY(0); }
        .close-modal { position: absolute; top: 1rem; right: 1rem; font-size: 1.25rem; color: #94a3b8; background: none; border:none; cursor: pointer; }
        .login-btn { width: 100%; padding: 0.875rem; background: #2563eb; color: white; font-weight: 600; border-radius: 0.5rem; margin-top: 1rem; }
        .toggle-auth { text-align: center; margin-top: 1.5rem; font-size: 0.875rem; color: #64748b; }
        .toggle-auth a { color: #2563eb; cursor: pointer; font-weight: 600; text-decoration: none; }
        .error-message { color: #dc2626; background-color: #fef2f2; padding: 0.75rem; border-radius: 0.375rem; border: 1px solid #fecaca; font-size: 0.875rem; text-align: center; margin-bottom: 1rem; }
        .premium-feature-list { list-style: none; margin: 1.5rem 0; text-align: left; }
        .premium-feature-list li { margin-bottom: 0.75rem; display: flex; align-items: flex-start; gap: 0.75rem; font-size: 0.95rem; color: #475569; }
        .check-icon { color: #10b981; flex-shrink: 0; }
        .price-tag { font-size: 2rem; font-weight: 800; color: #1e293b; text-align: center; margin: 1rem 0; }
        .price-tag span { font-size: 1rem; font-weight: 500; color: #64748b; }
        .hidden { display: none !important; }

        /* --- FOOTER --- */
        footer { border-top: 1px solid #e2e8f0; padding: 4rem 1rem 2rem; background-color: white; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 3rem; margin-bottom: 3rem; }
        .footer-section h3 { font-weight: 600; margin-bottom: 1.5rem; color: #0f172a; }
        .footer-section ul { list-style: none; }
        .footer-section ul li { margin-bottom: 0.75rem; }
        .footer-section a { color: #64748b; text-decoration: none; font-size: 0.95rem; transition: color 0.2s; cursor: pointer; }
        .footer-section a:hover { color: #2563eb; }
        .footer-bottom { border-top: 1px solid #e2e8f0; padding-top: 2rem; text-align: center; color: #64748b; font-size: 0.875rem; }

        @media (max-width: 768px) { .hero h1 { font-size: 2.25rem; } .nav-buttons { gap: 0.5rem; } .project-detail-image { height: 250px; } }
    </style>
</head>
<body>
    <!-- NAVEGACI√ìN -->
    <nav>
        <div class="container">
            <a onclick="showPage('home')" class="nav-brand">
                <svg class="logo-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="100" cy="100" r="100" fill="#F9F7F2" />
                    <circle cx="100" cy="100" r="92" fill="none" stroke="#1A1A1A" stroke-width="1" />
                    <defs>
                        <path id="textCircleTop" d="M 30,100 A 70,70 0 1,1 170,100" />
                        <path id="textCircleBottom" d="M 25,100 A 75,75 0 0,0 175,100" />
                    </defs>
                    <text font-family="'Inter', sans-serif" font-size="16" font-weight="700" fill="#1A1A1A" letter-spacing="2">
                        <textPath href="#textCircleTop" startOffset="50%" text-anchor="middle">PROYECTOSALEX</textPath>
                    </text>
                    <text x="100" y="108" font-family="'Playfair Display', serif" font-size="70" font-weight="800" fill="#1A1A1A" text-anchor="middle" dominant-baseline="middle">PA</text>
                    <text x="100" y="140" font-family="'Inter', sans-serif" font-size="10" font-weight="600" fill="#1A1A1A" text-anchor="middle" letter-spacing="1">EST. 2024</text>
                    <text font-family="'Inter', sans-serif" font-size="8" font-weight="600" fill="#1A1A1A" letter-spacing="1">
                        <textPath href="#textCircleBottom" startOffset="50%" text-anchor="middle">SMALL STEPS ‚Ä¢ LONG DISTANCES</textPath>
                    </text>
                </svg>
                <span>Proyectos Alex</span>
            </a>
            <div class="nav-buttons">
                <!-- BOT√ìN VOLVER AL INICIO -->
                <button class="btn-outline hidden" id="backHomeBtn" onclick="showPage('home')">Inicio</button>
                
                <button class="btn-primary" id="loginBtnNav" onclick="openAuthModal('login')">Ingresar</button>
                <button class="btn-outline" id="registerBtnNav" onclick="openAuthModal('signup')">Registrarse</button>
                
                <button class="btn-outline hidden" id="myAccountBtn" onclick="showPage('dashboard')">Mi Cuenta</button>
                <button class="btn-danger hidden" id="logoutBtn" onclick="handleLogout()">Salir</button>
            </div>
        </div>
    </nav>

    <!-- P√ÅGINA: HOME -->
    <div id="home" class="page active">
        <section class="hero">
            <div class="container">
                <div class="hero-badge"><span>‚ú® Plataforma de Proyectos Digitales</span></div>
                <h1>Dale Vida a Tus <span class="highlight">Proyectos</span></h1>
                <p>La plataforma para creadores. Comparte tus ideas, vende tus productos y crea tu portafolio.</p>
                <div class="hero-buttons">
                    <button class="btn-primary" onclick="handleCreateProjectClick()">Comenzar Ahora</button>
                    <button class="btn-outline" onclick="showPage('projects')">Explorar</button>
                </div>
            </div>
        </section>

        <section class="search-section">
            <div class="container">
                <div class="search-box">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                    <input type="text" placeholder="Buscar creadores, proyectos o categor√≠as..." onkeyup="filterProjects(this.value, 'homeProjectsGrid')">
                </div>
            </div>
        </section>

        <div class="ad-container"><div class="ad-placeholder"><span class="ad-label">Publicidad</span><span class="ad-content">Google AdSense</span></div></div>

        <section class="projects-section">
            <div class="container">
                <h2>Proyectos Recientes</h2>
                <div id="homeProjectsGrid" class="projects-grid"></div>
            </div>
        </section>
        
        <div class="ad-container" style="background-color: #ffffff; margin: 0; padding-bottom: 4rem;"><div class="ad-placeholder"><span class="ad-label">Publicidad</span><span class="ad-content">Espacio Publicitario</span></div></div>
    </div>

    <!-- P√ÅGINA: EXPLORAR PROYECTOS -->
    <div id="projects" class="page">
        <div class="dashboard-header">
            <div class="container">
                <h2>Todos los Proyectos</h2>
                <input type="text" placeholder="Buscar..." class="form-control" style="padding: 0.5rem; margin-top: 1rem; width: 100%; max-width: 300px;" onkeyup="filterProjects(this.value, 'allProjectsGrid')">
            </div>
        </div>
        <div class="container" style="padding: 2rem 1rem;">
            <div id="allProjectsGrid" class="projects-grid"></div>
        </div>
    </div>

    <!-- P√ÅGINA: DASHBOARD -->
    <div id="dashboard" class="page">
        <div class="dashboard-header">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <img id="dashboardAvatar" class="profile-avatar-large" style="width: 60px; height: 60px; margin-bottom:0;" src="" onerror="this.style.display='none'; document.getElementById('dashboardInitials').style.display='flex'">
                        <div id="dashboardInitials" class="profile-avatar-large" style="width: 60px; height: 60px; margin-bottom:0; display:none;">A</div>
                        <div>
                            <h2 id="userNameDisplay">Mi Cuenta</h2>
                            <p id="userEmailDisplay" style="color: #64748b;"></p>
                            <button onclick="openEditProfile()" style="font-size: 0.75rem; color: #2563eb; background: none; padding: 0; border: none; text-decoration: underline;">Editar perfil</button>
                        </div>
                    </div>
                    <button class="btn-outline" onclick="showPage('home')">‚Üê Volver al Inicio</button>
                </div>
            </div>
        </div>

        <div class="container" style="padding: 2rem 1rem;">
            <div class="ad-container" style="margin-top: 0; margin-bottom: 3rem;"><div class="ad-placeholder" style="height: 90px; max-width: 100%;"><span class="ad-label">Patrocinado</span><span class="ad-content">Anuncio Dashboard</span></div></div>

            <div class="stats-grid">
                <div class="stat-card"><h3>Mis Proyectos</h3><div class="value" id="userProjectCount">0</div></div>
                <div class="stat-card"><h3>Proyectos Destacados</h3><div class="value" id="userPremiumCount">0</div></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Mis Publicaciones</h3>
                <button class="btn-primary" onclick="showPage('create-project')">+ Nuevo Proyecto</button>
            </div>
            <div id="myProjectsGrid" class="projects-grid"></div>
        </div>
    </div>

    <!-- P√ÅGINA: PERFIL P√öBLICO -->
    <div id="user-profile" class="page">
        <div class="dashboard-header">
            <div class="container">
                <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                    <img id="publicProfileImg" class="profile-avatar-large" src="" onerror="this.style.display='none'; document.getElementById('publicProfileAvatar').style.display='flex'">
                    <div id="publicProfileAvatar" class="profile-avatar-large" style="display:none;">A</div>
                    <div>
                        <h2 id="publicProfileName">Nombre del Creador</h2>
                        <p style="color: #64748b;" id="publicProfileStats">0 proyectos publicados</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" style="padding: 2rem 1rem;">
            <h3>Proyectos de <span id="publicProfileNameSpan">este usuario</span></h3>
            <div id="publicProfileGrid" class="projects-grid"></div>
        </div>
    </div>

    <!-- P√ÅGINA: CREAR PROYECTO -->
    <div id="create-project" class="page">
        <div class="container">
            <div class="form-container">
                <h2 style="margin-bottom: 1.5rem;">Crear Nuevo Proyecto</h2>
                <form onsubmit="submitProject(event)">
                    <div class="form-group"><label>T√≠tulo *</label><input type="text" id="pTitle" required></div>
                    <div class="form-group"><label>Categor√≠a *</label><select id="pCat"><option>Tecnolog√≠a</option><option>Arte</option><option>Negocios</option><option>Educaci√≥n</option><option>Moda</option><option>Otros</option></select></div>
                    <div class="form-group"><label>Descripci√≥n *</label><textarea id="pDesc" rows="3" required></textarea></div>
                    <div class="form-group"><label>Precio (‚Ç¨) *</label><input type="number" id="pPrice" min="0" step="0.01" required></div>
                    <div class="form-group"><label>URL de la Imagen (Opcional)</label><input type="url" id="pImg" placeholder="https://ejemplo.com/foto.jpg"><small style="color: #64748b;">Deja vac√≠o para usar una imagen por defecto.</small></div>
                    <div class="form-group"><label>URL del Negocio / Sitio Web (Opcional)</label><input type="url" id="pUrl" placeholder="https://mi-negocio.com"></div>
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;"><button type="submit" class="btn-primary" style="flex: 1;">Publicar</button><button type="button" class="btn-outline" onclick="showPage('dashboard')">Cancelar</button></div>
                </form>
            </div>
        </div>
    </div>

    <!-- P√ÅGINA: EDITAR PROYECTO -->
    <div id="edit-project" class="page">
        <div class="container">
            <div class="form-container">
                <h2 style="margin-bottom: 1.5rem;">Editar Proyecto</h2>
                <form onsubmit="submitEditProject(event)">
                    <input type="hidden" id="editId">
                    <div class="form-group"><label>T√≠tulo *</label><input type="text" id="editTitle" required></div>
                    <div class="form-group"><label>Categor√≠a *</label><select id="editCat"><option>Tecnolog√≠a</option><option>Arte</option><option>Negocios</option><option>Educaci√≥n</option><option>Moda</option><option>Otros</option></select></div>
                    <div class="form-group"><label>Descripci√≥n *</label><textarea id="editDesc" rows="3" required></textarea></div>
                    <div class="form-group"><label>Precio (‚Ç¨) *</label><input type="number" id="editPrice" min="0" step="0.01" required></div>
                    <div class="form-group"><label>URL de la Imagen (Opcional)</label><input type="url" id="editImg" placeholder="https://ejemplo.com/foto.jpg"></div>
                    <div class="form-group"><label>URL del Negocio / Sitio Web (Opcional)</label><input type="url" id="editUrl" placeholder="https://mi-negocio.com"></div>
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;"><button type="submit" class="btn-primary" style="flex: 1;">Guardar Cambios</button><button type="button" class="btn-outline" onclick="showPage('dashboard')">Cancelar</button></div>
                </form>
            </div>
        </div>
    </div>

    <!-- P√ÅGINA: DETALLE DE PROYECTO -->
    <div id="project-detail" class="page">
        <div class="container" style="padding-top: 3rem; padding-bottom: 4rem;">
            <button class="btn-outline" onclick="showPage('home')" style="margin-bottom: 2rem;">‚Üê Volver al Inicio</button>
            <div id="detailContent"></div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Plataforma</h3>
                    <ul><li><a onclick="showPage('home')">Inicio</a></li><li><a onclick="showPage('projects')">Proyectos</a></li><li><a onclick="openAuthModal('login')">Ingresar</a></li></ul>
                </div>
                <div class="footer-section">
                    <h3>Legal</h3>
                    <ul><li><a onclick="alert('P√°gina de T√©rminos')">T√©rminos</a></li><li><a onclick="alert('P√°gina de Privacidad')">Privacidad</a></li><li><a onclick="alert('P√°gina de Cookies')">Cookies</a></li></ul>
                </div>
                <div class="footer-section">
                    <h3>S√≠guenos & Contacto</h3>
                    <ul style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <li><a href="https://instagram.com/proyectos.alex" target="_blank" style="display: flex; align-items: center; gap: 0.5rem;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg><span style="font-weight: 500;">@proyectos.alex</span></a></li>
                        <li><a href="https://www.tiktok.com/@proyectosalex" target="_blank" style="display: flex; align-items: center; gap: 0.5rem;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"></path></svg><span style="font-weight: 500;">@proyectosalex</span></a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom"><p>&copy; 2024 Proyectos Alex. Todos los derechos reservados.</p></div>
        </div>
    </footer>

    <!-- MODALES -->
    <!-- MODAL LOGIN/SIGNUP -->
    <div id="authModal" class="modal-overlay">
        <div class="modal-card">
            <button class="close-modal" onclick="closeAuthModal()">‚úï</button>
            <h2 id="authTitle" style="text-align: center; margin-bottom: 1.5rem;">Iniciar Sesi√≥n</h2>
            <div id="authErrorMsg" class="error-message hidden">Correo o contrase√±a incorrecta</div>
            <form onsubmit="handleAuthSubmit(event)">
                <div class="form-group hidden" id="nameGroup"><label>Nombre Completo</label><input type="text" id="authName" placeholder="Tu nombre"></div>
                
                <!-- NUEVO CAMPO DE FOTO DE PERFIL (Solo registro) -->
                <div class="form-group hidden" id="avatarGroup">
                    <label>URL Foto de Perfil (Opcional)</label>
                    <input type="url" id="authAvatar" placeholder="https://...">
                </div>

                <div class="form-group"><label>Correo Electr√≥nico</label><input type="email" id="authEmail" required placeholder="ejemplo@email.com"></div>
                <div class="form-group"><label>Contrase√±a</label><input type="password" id="authPass" required placeholder="******"></div>
                <button type="submit" class="login-btn" id="authSubmitBtn">Ingresar</button>
            </form>
            <div class="toggle-auth"><span id="authToggleText">¬øNo tienes cuenta?</span><a onclick="toggleAuthMode()" id="authToggleLink">Reg√≠strate aqu√≠</a></div>
        </div>
    </div>

    <!-- MODAL EDITAR PERFIL -->
    <div id="profileEditModal" class="modal-overlay">
        <div class="modal-card">
            <button class="close-modal" onclick="document.getElementById('profileEditModal').classList.remove('active')">‚úï</button>
            <h2 style="text-align: center; margin-bottom: 1.5rem;">Editar Perfil</h2>
            <form onsubmit="handleProfileEdit(event)">
                <div class="form-group"><label>Nombre</label><input type="text" id="editProfileName" required></div>
                <div class="form-group"><label>URL Foto de Perfil</label><input type="url" id="editProfileAvatar"></div>
                <button type="submit" class="login-btn">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <div id="premiumModal" class="modal-overlay">
        <div class="modal-card" style="text-align: center;">
            <button class="close-modal" onclick="closePremiumModal()">‚úï</button>
            <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìπ</div>
            <h2 style="margin-bottom: 0.5rem;">Video-An√°lisis Personalizado</h2>
            <p style="color: #64748b; font-size: 0.95rem;">Potencia tu proyecto con la voz de un experto.</p>
            <div class="price-tag">9‚Ç¨ <span>/ √∫nico</span></div>
            <ul class="premium-feature-list"><li><span class="check-icon">‚úì</span><span>An√°lisis detallado de tu propuesta</span></li><li><span class="check-icon">‚úì</span><span>Narraci√≥n profesional por Alex</span></li><li><span class="check-icon">‚úì</span><span>Destacamos los puntos clave</span></li><li><span class="check-icon">‚úì</span><span>Distintivo "Destacado" en la web</span></li></ul>
            <button onclick="handlePremiumPurchase()" class="btn-premium" style="justify-content: center; font-size: 1rem; padding: 1rem;">Contratar Video-An√°lisis</button>
            <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 1rem;">Pago √∫nico y seguro. Entrega en 48h.</p>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN SUPABASE ---
        const supabaseUrl = 'https://jvshcszolovsnqzkozka.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2c2hjc3pvbG92c25xemtvemthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDQ5NDgsImV4cCI6MjA3OTU4MDk0OH0.ty4wwxMhQ8gm1SgweSf9JxcDrvt2IGwKzkH4EQP8ZB4';
        const supabase = (supabaseUrl && supabaseUrl.startsWith('http')) ? window.supabase.createClient(supabaseUrl, supabaseKey) : null;

        // Estado Local
        let projects = JSON.parse(localStorage.getItem('alex_projects')) || [];
        let currentUser = JSON.parse(localStorage.getItem('alex_session')) || null;
        let isLoginMode = true;
        let selectedProjectId = null;

        // --- DEFINICI√ìN DE FUNCIONES ---
        
        async function fetchProjectsFromSupabase() {
            try {
                const { data, error } = await supabase.from('projects').select('*').order('created_at', { ascending: false });
                if (!error && data) { projects = data; renderProjects(); }
            } catch (err) { console.log("Modo local activo"); }
        }

        function handleProfileEdit(e) {
            e.preventDefault();
            const newName = document.getElementById('editProfileName').value;
            const newAvatar = document.getElementById('editProfileAvatar').value;
            
            if (currentUser) {
                currentUser.name = newName;
                currentUser.avatar = newAvatar;
                localStorage.setItem('alex_session', JSON.stringify(currentUser));
                
                let users = JSON.parse(localStorage.getItem('alex_users')) || [];
                const uIdx = users.findIndex(u => u.email === currentUser.email);
                if(uIdx !== -1) {
                    users[uIdx].name = newName;
                    users[uIdx].avatar = newAvatar;
                    localStorage.setItem('alex_users', JSON.stringify(users));
                }
                updateUI();
                updateDashboard();
                document.getElementById('profileEditModal').classList.remove('active');
            }
        }

        function openEditProfile() {
            if(currentUser) {
                document.getElementById('editProfileName').value = currentUser.name;
                document.getElementById('editProfileAvatar').value = currentUser.avatar || '';
                document.getElementById('profileEditModal').classList.add('active');
            }
        }

        function openUserProfile(email) {
            if (currentUser && email === currentUser.email) { showPage('dashboard'); return; }
            const userProjects = projects.filter(p => (p.authorEmail || p.author_email) === email);
            const authorName = userProjects.length > 0 ? (userProjects[0].authorName || userProjects[0].author_name) : 'Creador';
            const authorAvatar = userProjects.length > 0 ? (userProjects[0].authorAvatar || userProjects[0].author_avatar) : null;
            const initials = authorName.charAt(0).toUpperCase();

            document.getElementById('publicProfileName').textContent = authorName;
            document.getElementById('publicProfileStats').textContent = `${userProjects.length} proyectos publicados`;
            document.getElementById('publicProfileNameSpan').textContent = authorName;
            
            const pAvatar = document.getElementById('publicProfileAvatar');
            const pImg = document.getElementById('publicProfileImg');
            if (authorAvatar) {
                pImg.src = authorAvatar;
                pImg.style.display = 'block';
                pAvatar.style.display = 'none';
            } else {
                pImg.style.display = 'none';
                pAvatar.textContent = initials;
                pAvatar.style.display = 'flex';
            }

            const grid = document.getElementById('publicProfileGrid');
            grid.innerHTML = userProjects.length > 0 ? userProjects.map(p => createProjectCard(p, false)).join('') : '<p>Este usuario a√∫n no tiene proyectos.</p>';
            showPage('user-profile');
        }

        function updateUI() {
            const loginBtn = document.getElementById('loginBtnNav');
            const registerBtn = document.getElementById('registerBtnNav');
            const accountBtn = document.getElementById('myAccountBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            if (currentUser) {
                loginBtn.classList.add('hidden');
                registerBtn.classList.add('hidden');
                accountBtn.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');
            } else {
                loginBtn.classList.remove('hidden');
                registerBtn.classList.remove('hidden');
                accountBtn.classList.add('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        function updateDashboard() {
            if (!currentUser) return;
            document.getElementById('userNameDisplay').textContent = currentUser.name;
            document.getElementById('userEmailDisplay').textContent = currentUser.email;
            
            const dashAvatar = document.getElementById('dashboardAvatar');
            const dashInitials = document.getElementById('dashboardInitials');
            if(currentUser.avatar) {
                dashAvatar.src = currentUser.avatar;
                dashAvatar.style.display = 'block';
                dashInitials.style.display = 'none';
            } else {
                dashAvatar.style.display = 'none';
                dashInitials.textContent = currentUser.name.charAt(0).toUpperCase();
                dashInitials.style.display = 'flex';
            }
            
            const myProjects = projects.filter(p => (p.authorEmail || p.author_email) === currentUser.email);
            const premiumProjects = myProjects.filter(p => p.isPremium || p.is_premium).length;
            document.getElementById('userProjectCount').textContent = myProjects.length;
            document.getElementById('userPremiumCount').textContent = premiumProjects;
            
            const grid = document.getElementById('myProjectsGrid');
            grid.innerHTML = myProjects.length ? myProjects.map(p => createProjectCard(p, true)).join('') : '<p>No tienes proyectos a√∫n.</p>';
        }

        function createProjectCard(project, isMine = false) {
            const p = {
                ...project,
                imageUrl: project.imageUrl || project.image_url,
                businessUrl: project.businessUrl || project.business_url,
                isPremium: project.isPremium || project.is_premium,
                authorName: project.authorName || project.author_name,
                authorEmail: project.authorEmail || project.author_email,
                authorAvatar: project.authorAvatar || project.author_avatar,
                date: project.date || project.created_at
            };

            let imageHtml = `<div class="project-image-placeholder" onclick="openProjectDetail(${p.id})">üì¶</div>`;
            if (p.imageUrl) {
                imageHtml = `<img src="${p.imageUrl}" alt="${p.title}" onclick="openProjectDetail(${p.id})" onerror="this.parentElement.innerHTML='<div class=\'project-image-placeholder\' onclick=\'openProjectDetail(${p.id})\'>üì¶</div>'">`;
            }

            let avatarHtml = '';
            if(p.authorAvatar) {
                avatarHtml = `<img src="${p.authorAvatar}" class="author-avatar-small" alt="${p.authorName}">`;
            } else {
                const initials = p.authorName ? p.authorName.charAt(0).toUpperCase() : 'U';
                avatarHtml = `<div class="author-avatar-small">${initials}</div>`;
            }

            let visitBtnHtml = '';
            if (p.businessUrl) {
                let url = p.businessUrl.startsWith('http') ? p.businessUrl : 'https://' + p.businessUrl;
                visitBtnHtml = `<a href="${url}" target="_blank" class="btn-visit"><span>Visitar Sitio</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a>`;
            }

            let premiumBadge = p.isPremium ? `<div class="premium-badge"><span>üìπ</span> An√°lisis Solicitado</div>` : '';
            let premiumClass = p.isPremium ? 'is-premium' : '';

            let actionsHtml = '';
            if (isMine) {
                let premiumBtn = !p.isPremium 
                    ? `<button onclick="openPremiumModal(${p.id})" class="btn-premium"><span>Solicitar Video-An√°lisis</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></button>`
                    : `<button onclick="cancelPremium(${p.id})" class="btn-cancel-premium"><span>Cancelar An√°lisis</span></button>`;
                actionsHtml = `${premiumBtn}<div style="display: flex; gap: 0.5rem; width: 100%;"><button onclick="openEditProject(${p.id})" class="btn-edit"><span>Editar</span><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button><button onclick="deleteProject(${p.id})" class="btn-delete"><span>Eliminar</span></button></div>`;
            }

            return `
                <div class="project-card ${premiumClass}">
                    <div class="project-image">${imageHtml}</div>
                    <div class="project-content">
                        ${premiumBadge}
                        <small style="color: #64748b; text-transform: uppercase; font-size: 0.7rem; font-weight: 700;">${p.category}</small>
                        <h3 class="project-title-link" onclick="openProjectDetail(${p.id})">${p.title}</h3>
                        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">${p.description}</p>
                        
                        <div class="project-meta">
                            <span class="project-price">${p.price}‚Ç¨</span>
                            <div class="author-container" onclick="openUserProfile('${p.authorEmail}')">
                                ${avatarHtml}
                                <span class="project-author-link">${isMine ? 'T√∫' : p.authorName}</span>
                            </div>
                        </div>
                        ${visitBtnHtml}
                        ${actionsHtml}
                    </div>
                </div>
            `;
        }

        function renderAuthModal() {
            const title = document.getElementById('authTitle');
            const nameGroup = document.getElementById('nameGroup');
            const avatarGroup = document.getElementById('avatarGroup');
            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleText = document.getElementById('authToggleText');
            const toggleLink = document.getElementById('authToggleLink');

            if (isLoginMode) {
                title.textContent = "Iniciar Sesi√≥n";
                nameGroup.classList.add('hidden');
                avatarGroup.classList.add('hidden');
                document.getElementById('authName').removeAttribute('required');
                submitBtn.textContent = "Ingresar";
                toggleText.textContent = "¬øNo tienes cuenta?";
                toggleLink.textContent = "Reg√≠strate aqu√≠";
            } else {
                title.textContent = "Crear Cuenta";
                nameGroup.classList.remove('hidden');
                avatarGroup.classList.remove('hidden');
                document.getElementById('authName').setAttribute('required', 'true');
                submitBtn.textContent = "Registrarse";
                toggleText.textContent = "¬øYa tienes cuenta?";
                toggleLink.textContent = "Inicia sesi√≥n";
            }
        }

        function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('authEmail').value.trim();
            const password = document.getElementById('authPass').value.trim();
            const name = document.getElementById('authName').value.trim();
            const avatar = document.getElementById('authAvatar').value.trim();
            const errorMsg = document.getElementById('authErrorMsg');
            errorMsg.classList.add('hidden');

            const users = JSON.parse(localStorage.getItem('alex_users')) || [];

            if (isLoginMode) {
                const user = users.find(u => u.email === email && u.password === password);
                if (user) { loginUser(user); } else { errorMsg.textContent = "Correo o contrase√±a incorrecta"; errorMsg.classList.remove('hidden'); }
            } else {
                if (users.find(u => u.email === email)) { errorMsg.textContent = "Este correo ya est√° registrado"; errorMsg.classList.remove('hidden'); return; }
                const newUser = { name, email, password, avatar }; 
                users.push(newUser);
                localStorage.setItem('alex_users', JSON.stringify(users));
                alert('Cuenta creada. Iniciando sesi√≥n...');
                loginUser(newUser);
            }
        }

        function loginUser(user) {
            currentUser = { name: user.name, email: user.email, avatar: user.avatar };
            localStorage.setItem('alex_session', JSON.stringify(currentUser));
            closeAuthModal();
            updateUI();
            showPage('dashboard');
        }

        async function submitProject(e) {
            e.preventDefault();
            const newProject = {
                title: document.getElementById('pTitle').value,
                description: document.getElementById('pDesc').value,
                category: document.getElementById('pCat').value,
                price: document.getElementById('pPrice').value,
                imageUrl: document.getElementById('pImg').value,
                businessUrl: document.getElementById('pUrl').value,
                isPremium: false,
                authorName: currentUser.name,
                authorEmail: currentUser.email,
                authorAvatar: currentUser.avatar,
                date: new Date().toISOString()
            };

            if (supabase) {
                const { error } = await supabase.from('projects').insert([{
                    title: newProject.title,
                    description: newProject.description,
                    category: newProject.category,
                    price: newProject.price,
                    image_url: newProject.imageUrl,
                    business_url: newProject.businessUrl,
                    author_name: newProject.authorName,
                    author_email: newProject.authorEmail,
                    author_avatar: newProject.authorAvatar
                }]);
                if (!error) { alert('Proyecto publicado en la nube'); await fetchProjectsFromSupabase(); } else { alert('Error al subir: ' + error.message); }
            } else {
                newProject.id = Date.now(); projects.unshift(newProject); localStorage.setItem('alex_projects', JSON.stringify(projects)); alert('Proyecto publicado localmente'); renderProjects();
            }
            e.target.reset(); showPage('dashboard');
        }

        function filterProjects(query, gridId) {
            const term = query.toLowerCase();
            const grid = document.getElementById(gridId) || document.getElementById('allProjectsGrid');
            if (grid) {
                const filtered = projects.filter(p => 
                    p.title.toLowerCase().includes(term) || 
                    p.description.toLowerCase().includes(term) ||
                    p.category.toLowerCase().includes(term) ||
                    (p.authorName || p.author_name || '').toLowerCase().includes(term)
                );
                grid.innerHTML = filtered.length ? filtered.map(p => createProjectCard(p)).join('') : '<p>No se encontraron resultados</p>';
            }
        }

        function openAuthModal(mode) { document.getElementById('authErrorMsg').classList.add('hidden'); document.getElementById('authModal').classList.add('active'); isLoginMode = (mode === 'login'); renderAuthModal(); }
        function closeAuthModal() { document.getElementById('authModal').classList.remove('active'); document.getElementById('authPass').value = ''; }
        function toggleAuthMode() { isLoginMode = !isLoginMode; renderAuthModal(); }
        function handleLogout() { localStorage.removeItem('alex_session'); currentUser = null; updateUI(); showPage('home'); }
        function handleCreateProjectClick() { if (currentUser) { showPage('create-project'); } else { alert('Debes iniciar sesi√≥n.'); openAuthModal('signup'); } }
        function showPage(pageId) {
            if ((pageId === 'dashboard' || pageId === 'create-project' || pageId === 'edit-project') && !currentUser) { openAuthModal('login'); return; }
            const backHomeBtn = document.getElementById('backHomeBtn');
            if (pageId === 'home') { backHomeBtn.classList.add('hidden'); } else { backHomeBtn.classList.remove('hidden'); }
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
            if (pageId === 'dashboard') updateDashboard();
        }
        function openEditProject(id) { const p = projects.find(proj => proj.id === id); if (!p) return; const project = { ...p, imageUrl: p.imageUrl || p.image_url, businessUrl: p.businessUrl || p.business_url }; document.getElementById('editId').value = project.id; document.getElementById('editTitle').value = project.title; document.getElementById('editCat').value = project.category; document.getElementById('editDesc').value = project.description; document.getElementById('editPrice').value = project.price; document.getElementById('editImg').value = project.imageUrl || ''; document.getElementById('editUrl').value = project.businessUrl || ''; showPage('edit-project'); }
        async function submitEditProject(e) { e.preventDefault(); const id = parseInt(document.getElementById('editId').value); const updatedData = { title: document.getElementById('editTitle').value, category: document.getElementById('editCat').value, description: document.getElementById('editDesc').value, price: document.getElementById('editPrice').value, imageUrl: document.getElementById('editImg').value, businessUrl: document.getElementById('editUrl').value }; if (supabase) { const { error } = await supabase.from('projects').update({ title: updatedData.title, category: updatedData.category, description: updatedData.description, price: updatedData.price, image_url: updatedData.imageUrl, business_url: updatedData.businessUrl }).eq('id', id); if (!error) { alert('Proyecto actualizado en la nube'); await fetchProjectsFromSupabase(); } } else { const projectIndex = projects.findIndex(p => p.id === id); if (projectIndex !== -1) { Object.assign(projects[projectIndex], updatedData); localStorage.setItem('alex_projects', JSON.stringify(projects)); alert('Proyecto actualizado localmente'); renderProjects(); } } showPage('dashboard'); }
        async function deleteProject(id) { if (confirm('¬øEst√°s seguro de que quieres eliminar este proyecto de forma permanente?')) { if (supabase) { const { error } = await supabase.from('projects').delete().eq('id', id); if (!error) await fetchProjectsFromSupabase(); } else { projects = projects.filter(p => p.id !== id); localStorage.setItem('alex_projects', JSON.stringify(projects)); renderProjects(); } updateDashboard(); } }
        function openPremiumModal(projectId) { selectedProjectId = projectId; document.getElementById('premiumModal').classList.add('active'); }
        function closePremiumModal() { document.getElementById('premiumModal').classList.remove('active'); selectedProjectId = null; }
        async function handlePremiumPurchase() { if (!selectedProjectId) return; const btn = document.querySelector('#premiumModal .btn-premium'); btn.innerHTML = 'Procesando...'; btn.disabled = true; setTimeout(async () => { if (supabase) { await supabase.from('projects').update({ is_premium: true }).eq('id', selectedProjectId); await fetchProjectsFromSupabase(); } else { const idx = projects.findIndex(p => p.id === selectedProjectId); if (idx !== -1) { projects[idx].isPremium = true; localStorage.setItem('alex_projects', JSON.stringify(projects)); } } alert('¬°Pago realizado con √©xito!'); closePremiumModal(); updateDashboard(); renderProjects(); btn.innerHTML = 'Contratar Video-An√°lisis'; btn.disabled = false; }, 1500); }
        async function cancelPremium(id) { if (supabase) { await supabase.from('projects').update({ is_premium: false }).eq('id', id); await fetchProjectsFromSupabase(); } else { const idx = projects.findIndex(p => p.id === id); if (idx !== -1) { projects[idx].isPremium = false; localStorage.setItem('alex_projects', JSON.stringify(projects)); } } alert('Solicitud cancelada.'); renderProjects(); updateDashboard(); }
        function openProjectDetail(id) { const p = projects.find(proj => proj.id === id); if (!p) return; const project = { ...p, imageUrl: p.imageUrl || p.image_url, businessUrl: p.businessUrl || p.business_url, authorName: p.authorName || p.author_name, authorEmail: p.authorEmail || p.author_email, date: p.date || p.created_at }; const detailContent = document.getElementById('detailContent'); let imgHtml = project.imageUrl ? `<img src="${project.imageUrl}" class="project-detail-image" alt="${project.title}">` : `<div class="project-detail-image" style="display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #cbd5e1;">üì¶</div>`; let visitBtn = ''; if (project.businessUrl) { let url = project.businessUrl.startsWith('http') ? project.businessUrl : 'https://' + project.businessUrl; visitBtn = `<a href="${url}" target="_blank" class="btn-primary" style="display: inline-block; text-align: center; text-decoration: none; padding: 0.75rem 1.5rem;">Visitar Sitio Web</a>`; } const authorEmail = project.authorEmail || project.author_email; const authorName = project.authorName || project.author_name; detailContent.innerHTML = `${imgHtml}<div class="project-detail-header"><span class="detail-category">${project.category}</span><h1 class="project-detail-title" style="margin-top: 1rem;">${project.title}</h1><div class="project-detail-meta"><span class="detail-price">${project.price}‚Ç¨</span><span class="project-author-link" onclick="openUserProfile('${authorEmail}')" style="font-size: 1rem; font-weight: 500;">Publicado por <strong>${authorName}</strong></span><span>${new Date(project.date).toLocaleDateString()}</span></div></div><div style="font-size: 1.1rem; line-height: 1.8; color: #334155; margin-bottom: 3rem;"><p>${project.description.replace(/\n/g, '<br>')}</p></div>${visitBtn}`; showPage('project-detail'); }

        // --- INICIALIZACI√ìN (AL FINAL) ---
        document.addEventListener('DOMContentLoaded', async () => {
            updateUI();
            if (supabase) { await fetchProjectsFromSupabase(); }
            renderProjects();
        });
    </script>
</body>
</html>
